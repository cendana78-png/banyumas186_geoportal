<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Desa Pekunden - Geoportal</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search@3.0.2/dist/leaflet-search.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        :root { 
            --color-primary: #1a1a1b; 
            --color-secondary: #e7b51f; 
            --color-accent: #ff0000;
            --color-text-dark: #333;
            --overlay-dark: rgba(0, 0, 0, 0.7);
        }

        body, html { 
            margin: 0; padding: 0; min-height: 100%; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            display: flex; flex-direction: column; 
            background-color: #f8f9fa;
        }

        /* --- HEADER & NAV --- */
        .main-header { 
            background-color: var(--color-primary); color: white; 
            padding: 0 5%; display: flex; justify-content: space-between; 
            align-items: center; height: 70px; position: sticky; top: 0; z-index: 2000;
        }
        .header-left { display: flex; align-items: center; }
        .header-left img { width: 40px; height: 40px; margin-right: 12px; }
        .logo-text { font-size: 20px; font-weight: 700; }

        nav { display: flex; align-items: center; height: 100%; }
        nav a { color: white; text-decoration: none; padding: 0 20px; font-size: 15px; display: flex; align-items: center; height: 100%; }
        nav a:hover { background-color: rgba(255,255,255,0.1); color: var(--color-secondary); }

        .nav-dropdown { position: relative; height: 100%; }
        .nav-dropdown-content {
            display: none; position: absolute; background-color: white;
            min-width: 200px; box-shadow: 0px 8px 16px rgba(0,0,0,0.15);
            z-index: 2100; top: 70px; left: 0; border-radius: 0 0 8px 8px;
        }
        .nav-dropdown-content a { color: var(--color-text-dark) !important; padding: 15px 20px !important; display: block !important; border-bottom: 1px solid #f0f0f0; }
        .nav-dropdown:hover .nav-dropdown-content { display: block; }

        .hero-section {
            background: linear-gradient(var(--overlay-dark), var(--overlay-dark)), 
                        url('https://images.unsplash.com/photo-1596401057633-5310bad5af39?auto=format&fit=crop&w=1350&q=80'); 
            background-size: cover; padding: 60px 5%; color: white; text-align: center;
        }

        .container { flex: 1; padding: 0 5% 50px 5%; margin-top: -40px; }
        .grid-layout { display: grid; grid-template-columns: 1fr 2.5fr; gap: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 5px solid var(--color-secondary); }

        /* --- MAP STYLE --- */
        #map-pekunden { height: 600px; width: 100%; border-radius: 12px; border: 1px solid #ddd; z-index: 1; }
        .label-permanen {
            background: white; border: 1px solid #444; border-radius: 4px; padding: 1px 5px;
            font-size: 10px; font-weight: bold; color: #333; box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        footer { background-color: var(--color-primary); color: white; text-align: center; padding: 20px; font-size: 13px; }

        @media (max-width: 900px) { .grid-layout { grid-template-columns: 1fr; } }

        .leaflet-control-search {
    z-index: 1000 !important;
    background: white;
    border: 2px solid #e7b51f !important; /* Warna kuning khas tema Anda */
}

/* --- RESPONSIVE FIXES --- */

/* 1. Perbaikan Header & Navigasi */
.main-header {
    flex-wrap: wrap; /* Izinkan menu turun jika layar sempit */
    height: auto; 
    min-height: 70px;
    padding: 10px 5%;
}

nav {
    width: 100%; /* Navigasi memenuhi lebar di HP */
    justify-content: center;
    overflow-x: auto; /* Jika menu terlalu banyak, bisa di-swipe horizontal */
    white-space: nowrap;
    margin-top: 10px;
}

nav a {
    padding: 10px 12px;
    font-size: 13px; /* Perkecil teks sedikit di HP */
}

/* 2. Grid Layout & Container */
.grid-layout {
    display: flex;
    flex-direction: column; /* Stack vertikal secara default */
    gap: 15px;
}

@media (min-width: 901px) {
    .grid-layout {
        display: grid;
        grid-template-columns: 1fr 2.5fr; /* Kembali ke layout desktop */
    }
}

/* 3. Penyesuaian Hero Section */
.hero-section {
    padding: 40px 5%;
}
.hero-section h1 {
    font-size: 1.8rem;
}

/* 4. Penyesuaian Peta */
#map-pekunden {
    height: 400px; /* Perkecil tinggi peta di HP agar tidak memenuhi seluruh layar */
}

@media (min-width: 768px) {
    #map-pekunden {
        height: 600px;
    }
}

/* 5. Search Bar Responsive */
.leaflet-control-search {
    width: 250px !important; /* Batasi lebar agar tidak menutupi peta */
}

@media (max-width: 480px) {
    .leaflet-control-search {
        width: 180px !important;
        font-size: 12px;
    }
    .logo-text { font-size: 16px; }
}

/* 6. Hilangkan Tooltip di HP agar tidak kotor (Opsional) */
@media (max-width: 600px) {
    .label-permanen {
        display: none; /* Sembunyikan label permanen agar peta bersih di HP */
    }
    /* Namun popup tetap muncul saat diklik */
}
    </style>
</head>
<body>
      <header class="main-header">
        <div class="header-left">
            <img src="Banyumas.png" alt="Logo">
            <span class="logo-text">Geoportal Banyumas</span>
        </div>
        <nav>
            <a href="index.html"><i class="fas fa-home"></i> Beranda</a>
            <a href="peta_kecamatan.html"><i class="fas fa-map"></i> Peta Banyumas</a> 
            <div class="nav-dropdown">
                <a href="#"><i class="fas fa-map-marked-alt"></i> Peta Desa <i class="fas fa-caret-down"></i></a>
                <div class="nav-dropdown-content">
                    <a href="desa_binangun.html">Binangun</a>
                    <a href="desa_danaraja.html">Danaraja</a>
                    <a href="desa_dawuhan.html">Dawuhan</a>
                    <a href="desa_kalisube.html">Kalisube</a>
                    <a href="desa_karangrau.html">Karangrau</a>
                    <a href="desa_kedunggede.html">Kedunggede</a>
                    <a href="desa_kedunguter.html">Kedunguter</a>
                    <a href="desa_kejawar.html">Kejawar</a>
                    <a href="desa_papringan.html">Papringan</a>
                    <a href="desa_pasinggangan.html">Pasinggangan</a>
                    <a href="desa_pekunden.html">Pekunden</a>
                    <a href="desa_sudagaran.html">Sudagaran</a>
                </div>
            </div>
            <a href="tentang.html"><i class="fas fa-info-circle"></i> Tentang</a>
        </nav>
    </header>

    <section class="hero-section">
        <h1>Desa Wisata Pekunden</h1>
        <p>Visualisasi Spasial Batas Wilayah, Tata Guna Lahan, dan Fasilitas Desa</p>
    </section>

    <div class="container">
        <div class="grid-layout">
            <div class="sidebar">
              <div class="card">
    <h3><i class="fas fa-feather-alt"></i> Deskripsi Wilayah</h3>
    <div class="desc-text">
        <p><b>Desa Pekunden</b> merupakan salah satu desa bersejarah di Kecamatan Banyumas yang kini dikenal sebagai <b>Desa Wisata Kreatif</b>. Wilayah ini memiliki karakteristik unik sebagai pusat pemukiman padat yang berdampingan dengan area agraris yang subur.</p>
        
        <div class="highlight-box" style="background: #fff9e6; border-left: 4px solid #e7b51f; padding: 15px; margin: 20px 0; font-style: italic;">
            "Pekunden dikenal dengan ikon wisata Oemah Gamelan dan sentra industri rumahan Nopia yang melegenda."
        </div>

        <p>Secara geografis, Pekunden berbatasan langsung dengan Desa Sudagaran di sisi timur, memberikan pengaruh kuat pada aktivitas ekonomi dan sosial. Desa ini menjadi titik krusial dalam pelestarian budaya Jawa di Kabupaten Banyumas.</p>
        
        <ul style="padding-left: 20px; line-height: 1.8;">
            <li><b>Ikon Budaya:</b> Gamelan & Nopia</li>
            <li><b>Topografi:</b> Dataran Rendah</li>
            <li><b>Fungsi Lahan:</b> Hunian & Pertanian</li>
        </ul>
    </div>
</div>

<div class="card">
    <h3><i class="fas fa-layer-group"></i> Legenda Peta</h3>
    <div style="font-size: 14px; color: #666; line-height: 1.6;">
        <p><span style="color:red; font-weight:bold;">---</span> Batas Administrasi Desa</p>
        <p><i class="fas fa-circle" style="color:#8bc34a;"></i> Balai Desa</p>
        <p><i class="fas fa-circle" style="color:red;"></i> Lokasi Strategis / Rumah</p>
        <p><i class="fas fa-circle" style="color:#ffeb3b;"></i> Sarana Kesehatan</p>
    </div>
</div>
            </div>

            <div class="main-content">
                <div class="card">
                    <div id="map-pekunden"></div>
                </div>
            </div>
        </div>
    </div>

    <footer>&copy; 2025 Geoportal Pekunden - Kecamatan Banyumas</footer>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="https://unpkg.com/leaflet-search@3.0.2/dist/leaflet-search.min.js"></script>

    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    
    <script>
        // 1. Inisialisasi Peta
        var map = L.map('map-pekunden').setView([-7.5195, 109.2940], 15);

        // 2. Base Maps
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        var satelit = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

        // 3. Grup Layer
        var grupBatas = L.layerGroup().addTo(map);
        var grupBalaiDesa = L.layerGroup().addTo(map);
        var grupRumah = L.layerGroup().addTo(map);
        var grupLahan = L.layerGroup(); 
        var grupJalan = L.layerGroup(); 
        var grupFasilitas = L.layerGroup(); 

        // 4. Fungsi Label (PENTING: Memastikan semua layer punya label)function applyLabel(feature, layer) {
    // Mencari nama di berbagai kemungkinan penulisan kolom
   function applyLabel(feature, layer) {
    // Mencari nama dari berbagai kemungkinan kolom di GeoJSON
    var name = feature.properties.nama || feature.properties.Nama || feature.properties.NAMA || "";
    
    if (name) {
        // Simpan ke properti 'nama' (huruf kecil) agar seragam untuk pencarian
        feature.properties.nama = name; 
        
        layer.bindTooltip(name.toString(), { 
            permanent: true, 
            direction: 'top', 
            className: 'label-permanen' 
        });
        layer.bindPopup("<b>Lokasi:</b> " + name);
    }
}


        // 5. Load GeoJSON
        
      // --- 1. INISIALISASI GRUP PENCARIAN (Wajib di Paling Atas sebelum Fetch) ---
var searchGroup = L.featureGroup(); 

// --- 2. LOAD GEOJSON ---

// Batas Desa
fetch('batas_desa_pekunden.geojson').then(res => res.json()).then(data => {
    var layer = L.geoJSON(data, { 
        style: { color: "#ff0000", weight: 3, dashArray: '5, 10', fillColor: "#ff0000", fillOpacity: 0.1 }, 
        onEachFeature: applyLabel 
    }).addTo(grupBatas);
    searchGroup.addLayer(layer); 
});

// Balai Desa
fetch('balai_desa.geojson').then(res => res.json()).then(data => {
    var layer = L.geoJSON(data, { 
        pointToLayer: (f, ll) => L.circleMarker(ll, { radius: 8, fillColor: "#8bc34a", color: "#fff", weight: 2, fillOpacity: 1 }),
        onEachFeature: applyLabel 
    }).addTo(grupBalaiDesa);
    searchGroup.addLayer(layer); // Tambahkan ini agar bisa dicari
});

// Rumah
fetch('rumah_saya.geojson').then(res => res.json()).then(data => {
    var layer = L.geoJSON(data, { 
        pointToLayer: (f, ll) => L.circleMarker(ll, { radius: 9, fillColor: "#ff0000", color: "#fff", weight: 2, fillOpacity: 1 }),
        onEachFeature: applyLabel 
    }).addTo(grupRumah);
    searchGroup.addLayer(layer); // Tambahkan ini agar bisa dicari
});

// Lahan (Sawah & Kebun)
fetch('kebun.geojson').then(res => res.json()).then(data => { 
    var layer = L.geoJSON(data, { 
        style: { color: "#2e7d32", fillColor: "#4caf50", fillOpacity: 0.4 }, 
        onEachFeature: applyLabel 
    }).addTo(grupLahan);
    searchGroup.addLayer(layer);
});

fetch('sawah.geojson').then(res => res.json()).then(data => { 
    var layer = L.geoJSON(data, { 
        style: { color: "#f9a825", fillColor: "#fff176", fillOpacity: 0.4 }, 
        onEachFeature: applyLabel 
    }).addTo(grupLahan);
    searchGroup.addLayer(layer);
});

// Jalan & Sungai
const lineList = [ 
    {f:'jl_desa.geojson', c:'#555'}, 
    {f:'jl_kecamatan.geojson', c:'#d32f2f'}, 
    {f:'jl_sungai.geojson', c:'#0288d1'} 
];
lineList.forEach(item => {
    fetch(item.f).then(res => res.json()).then(data => {
        var layer = L.geoJSON(data, { 
            style: { color: item.c, weight: 2 }, 
            onEachFeature: applyLabel 
        }).addTo(grupJalan);
        searchGroup.addLayer(layer);
    });
});

// Fasilitas Detail
const pointList = [ 
    {f:'kesehatan.geojson', c:'#ffeb3b'}, 
    {f:'sekolah.geojson', c:'#e91e63'}, 
    {f:'tempat_ibadah.geojson', c:'#9c27b0'} 
];
pointList.forEach(item => {
    fetch(item.f).then(res => res.json()).then(data => {
        var layer = L.geoJSON(data, {
            pointToLayer: (f, ll) => L.circleMarker(ll, { radius: 6, fillColor: item.c, color: "#fff", weight: 1.5, fillOpacity: 1 }),
            onEachFeature: applyLabel
        }).addTo(grupFasilitas);
        searchGroup.addLayer(layer);
    });
});
        // 6. Logika Zoom (Rendering)
        function checkZoom() {
            var currentZoom = map.getZoom();
            
            // Zoom 15 ke atas: Munculkan Lahan dan Jalan
            if (currentZoom >= 15) {
                if (!map.hasLayer(grupLahan)) map.addLayer(grupLahan);
                if (!map.hasLayer(grupJalan)) map.addLayer(grupJalan);
            } else {
                map.removeLayer(grupLahan);
                map.removeLayer(grupJalan);
            }

            // Zoom 17 ke atas: Munculkan Point Detail
            if (currentZoom >= 17) {
                if (!map.hasLayer(grupFasilitas)) map.addLayer(grupFasilitas);
            } else {
                map.removeLayer(grupFasilitas);
            }
        }

        map.on('zoomend', checkZoom);
        checkZoom(); // Jalankan saat startup

      // --- UPDATE NOMOR 7: FITUR SEARCH LOKAL ---

// 1. Gabungkan layer-layer yang ingin bisa dicari
var searchGroup = L.featureGroup([
    grupBatas, 
    grupBalaiDesa, 
    grupRumah, 
    grupFasilitas,
    grupLahan,
    grupJalan,
      grupFasilitas
]);

// 2. Inisialisasi Kontrol Pencarian (Versi Perbaikan)
var searchControl = new L.Control.Search({
    layer: searchGroup,
    propertyName: 'nama',
    marker: false,
    initial: false,
    zoom: 18,
    collapsed: false,
    textPlaceholder: 'Cari (contoh: Rumah Saya)...',
    buildTip: function(text, val) {
        return '<a href="#" class="">' + text + '</a>';
    },
    filterData: function(text, records) {
        var ret = {}, i;
        for (i in records) {
            if (i.toLowerCase().indexOf(text.toLowerCase()) !== -1)
                ret[i] = records[i];
        }
        return ret;
    }
});

// 3. Logika agar Tooltip/Popup otomatis terbuka saat hasil diklik
searchControl.on('search:locationfound', function(e) {
    if(e.layer._popup) e.layer.openPopup();
    else if(e.layer._tooltip) e.layer.openTooltip();
});

map.addControl(searchControl);

// 4. Update Kontrol Layer (BaseMaps & Overlays)
L.control.layers({"Peta Standar": osm, "Satelit": satelit}, {
    "Batas Desa": grupBatas,
    "Balai Desa": grupBalaiDesa,
    "Rumah Utama": grupRumah,
    "Sawah/Kebun": grupLahan,
    "Jalan & Sungai": grupJalan,
    "Fasilitas Detail": grupFasilitas
}).addTo(map);

// 1. Agar peta tidak rusak tampilannya saat HP diputar (Landscape/Portrait)
        window.addEventListener('resize', function() {
            setTimeout(() => {
                map.invalidateSize();
            }, 200);
        });

        // 2. Memperbaiki perilaku menu dropdown di HP
        document.querySelectorAll('.nav-dropdown-content a').forEach(item => {
            item.addEventListener('click', () => {
                const dropdown = document.querySelector('.nav-dropdown-content');
                dropdown.style.display = 'none';
                setTimeout(() => {
                    dropdown.style.removeProperty('display');
                }, 500);
            });
        });
    </script>
</body>
</html>
